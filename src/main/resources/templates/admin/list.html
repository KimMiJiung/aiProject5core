<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>관리자 - 멤버 관리</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"/>
	<link th:href="@{/css/adminList.css}" rel="stylesheet">
</head>
<body>
    <div class="wrapper">
        <div class="sidebar">
            <div class="sidebar__logo"><div class="sidebar__logo-title">관리 메뉴</div></div>
            <div class="sidebar__section-title">Navigation</div>
            <ul class="menu-list">
                <li><a th:href="@{/main}" class="menu-item"><span class="menu-item__bullet"></span><span>메인 대시보드</span></a></li>
                <li><a th:href="@{/admin/profile}" class="menu-item"><span class="menu-item__bullet"></span><span>프로필</span></a></li>
                <li><a th:href="@{/admin/list}" class="menu-item menu-item--active"><span class="menu-item__bullet"></span><span>멤버 관리</span></a></li>
                <li><a th:href="@{/admin/globalSales}" class="menu-item"><span class="menu-item__bullet"></span><span>글로벌 판매 실적</span></a></li>
                <li><a th:href="@{/admin/aiForecast}" class="menu-item"><span class="menu-item__bullet"></span><span>AI수요예측</span></a></li>
                <li><a th:href="@{/admin/modelSales}" class="menu-item"><span class="menu-item__bullet"></span><span>차량별 판매 실적</span></a></li>
            </ul>
        </div>

        <div class="main">
            <header class="header">
                <div class="header__left">
                    <div class="logo">HYUNDAI CRM</div>
                    <div class="header__chip">Admin Dashboard</div>
                </div>
                <div class="header__right">
                    <span class="user-label">관리자</span>
                    <span class="fw-bold">[[${#authentication.getPrincipal().getUsername()}]] 님</span>
                    <a th:href="@{/logout}" class="logout-btn">로그아웃</a>
                </div>
            </header>

            <div class="content">
                <div class="d-flex align-items-baseline mb-2">
                    <h2 class="fw-bold mb-0" style="color: navy;">멤버 관리</h2>
                    <span class="stat-text">
                        총 <span th:text="${memberPage.totalElements}">0</span>건 | 총 <span th:text="${memberPage.totalPages}">0</span>페이지
                    </span>
                </div>
                <p class="text-muted mb-4" style="font-size: 14px;">사용자 정보를 검색하고 권한 및 상태를 관리합니다.</p>

                <form id="searchForm" th:action="@{/admin/list}" method="get">
                    <input type="hidden" name="page" id="currentPage" th:value="${memberPage.number}"/>
                    <div class="search-area shadow-sm">
                        <div class="d-flex gap-2">
                            <select class="form-select form-select-sm auto-submit" name="role" style="width: 130px;">
                                <option value="ALL" th:selected="${currentRole == 'ALL'}">전체 역할</option>
                                <option th:each="role : ${roles}" th:value="${role}" th:text="${role}" th:selected="${currentRole == role.toString()}"></option>
                            </select>
                            <select class="form-select form-select-sm auto-submit" name="sort" style="width: 180px">
                                <option value="id,asc" th:selected="${currentSort == 'id,asc'}">PK ID 오름차순</option>
                                <option value="memberId,asc" th:selected="${currentSort == 'memberId,asc'}">로그인 ID 오름차순</option>
                                <option value="joinDate,desc" th:selected="${currentSort == 'joinDate,desc'}">가입일 최신순</option>
                                <option value="name,asc" th:selected="${currentSort == 'name,asc'}">이름 오름차순</option>
                            </select>
                        </div>
                        <div class="d-flex gap-1">
                            <input type="search" name="keyword" class="form-control form-control-sm" style="width: 280px;" placeholder="검색어 입력" th:value="${currentKeyword}">
                            <button type="submit" class="btn btn-sm btn-dark px-3" style="background-color: navy;">검색</button>
                        </div>
                    </div>
                </form>

                <div class="table-container shadow-sm">
                    <table class="table table-hover align-middle">
                        <thead>
                            <tr>
                                <th class="col-id">ID</th>
                                <th class="col-login-id">로그인 ID</th>
                                <th class="col-name">이름</th>
                                <th class="col-phone">연락처</th>
                                <th class="col-email">이메일</th> <th class="col-date">가입일</th>
                                <th class="col-role">역할</th>
                                <th class="col-status">상태</th>
                                <th class="col-manage">관리</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="member : ${memberPage.content}">
                                <td class="text-center" th:text="${member.id}"></td>
                                <td class="text-center fw-bold text-primary" th:text="${member.memberId}"></td>
                                <td class="text-center" th:text="${member.name}"></td>
                                <td class="text-center" th:text="${member.phone}"></td>
                                <td class="text-center text-truncate" th:text="${member.email}"></td>
                                <td class="text-center" th:text="${#temporals.format(member.joinDate, 'yyyy-MM-dd')}"></td>
                                <td>
                                    <select class="form-select form-select-sm" disabled style="background-color: #f8f9fa;">
                                        <option th:each="role : ${roles}" th:text="${role}" th:selected="${member.role == role}"></option>
                                    </select>
                                </td>
                                <form th:action="@{/admin/update-status}" method="post">
                                    <input type="hidden" name="id" th:value="${member.id}" />
                                    <td>
                                        <select class="form-select form-select-sm" name="status">
                                            <option value="ACTIVE" th:selected="${member.status == 'ACTIVE'}">활동 중</option>
                                            <option value="INACTIVE" th:selected="${member.status == 'INACTIVE'}">비활동</option>
                                            <option value="PENDING" th:selected="${member.status == 'PENDING'}">승인 대기</option>
                                            <option value="BLOCKED" th:selected="${member.status == 'BLOCKED'}">차단됨</option>
                                        </select>
                                    </td>
                                    <td class="text-center"><button type="submit" class="btn-update">수정</button></td>
                                </form>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="pagination-container">
                    <div class="stat-text" style="margin-left: 0;">
                        페이지당 <span th:text="${memberPage.size}">10</span>건 | 총 <span th:text="${memberPage.totalPages}">0</span>페이지
                    </div>
                    <nav th:if="${memberPage.totalPages > 1}">
                        <ul class="pagination pagination-sm mb-0">
                            <li class="page-item" th:classappend="${!memberPage.hasPrevious} ? 'disabled'">
                                <a class="page-link" th:href="@{/admin/list(page=${memberPage.number - 1}, role=${currentRole}, sort=${currentSort}, keyword=${currentKeyword})}">이전</a>
                            </li>
                            <li class="page-item" th:each="i : ${#numbers.sequence(0, memberPage.totalPages - 1)}" th:classappend="${i == memberPage.number} ? 'active'">
                                <a class="page-link" th:href="@{/admin/list(page=${i}, role=${currentRole}, sort=${currentSort}, keyword=${currentKeyword})}" th:text="${i + 1}"></a>
                            </li>
                            <li class="page-item" th:classappend="${!memberPage.hasNext} ? 'disabled'">
                                <a class="page-link" th:href="@{/admin/list(page=${memberPage.number + 1}, role=${currentRole}, sort=${currentSort}, keyword=${currentKeyword})}">다음</a>
                            </li>
                        </ul>
                    </nav>
                    <div style="width: 150px;"></div> 
                </div>
            </div>
        </div>
    </div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script>
        $(document).ready(function() {
            $('.auto-submit').on('change', function() {
                $('#currentPage').val(0);
                $('#searchForm').submit();
            });
        });
    </script>
</body>
</html>