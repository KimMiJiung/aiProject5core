<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>회원수정 - HYUNDAI CRM</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
  <link th:href="@{/css/updateMember.css}" rel="stylesheet">
</head>
<body>
	<!-- 헤더 -->
	<th:block th:replace="~{top}"></th:block>
  <div class="layout">
    <div class="shell">
      <!-- 좌측 메뉴 -->
      <aside class="sidebar" aria-label="마이페이지 메뉴">
        <div class="sidebar__section-title">마이페이지</div>
        <ul class="sidebar__menu">
		  <li class="sidebar__item" th:if="${member.role == member.role.CUSTOMER}">
		    <a th:href="@{|/counseling/applyList/${#authentication.getPrincipal().getUsername()}|}" class="sidebar__link">상담 목록</a>
		  </li>
          <li class="sidebar__item">
            <a th:href="@{|/member/update/${#authentication.getPrincipal().getUsername()}|}" class="sidebar__link sidebar__link--active">회원수정</a>
          </li>
          <li class="sidebar__item" th:if="${member.role == member.role.CUSTOMER}">
            <a th:href="@{/sale/list}" class="sidebar__link">구매 내역</a>
          </li>
        </ul>
        <div class="sidebar__caption">로그인한 계정 정보를 수정할 수 있습니다.</div>
      </aside>

      <!-- 메인 콘텐츠 -->
      <main class="main" aria-label="회원정보 수정">
        <div class="main__header">
          <div class="main__title-block">
            <h1 class="page-title">회원 정보 수정</h1>
            <p class="page-subtitle">아이디 및 기본정보는 변경할 수 없으며, 비밀번호와 연락처 · 이메일 · 주소만 수정 가능합니다.</p>
          </div>
          <span class="chip-current">현재 페이지 · 회원수정</span>
        </div>

        <section class="card" aria-label="회원 정보 수정 폼">
          <h2 class="card__title">기본 정보</h2>
          <p class="card__subtitle">필수 항목을 확인 후 정보를 수정해 주세요.</p>

          <form th:object="${member}" th:action="@{/member/update}" method="post">
			<input type="hidden" th:field="*{role}">
            <div class="form-grid">
              <div class="form-group">
                <label for="memberId" class="form-label">아이디</label>
                <input id="memberId" name="memberId" type="text" class="form-input" th:field="*{memberId}" readonly />
              </div>

              <div class="form-group">
                <label for="name" class="form-label">이름</label>
                <input id="name" name="name" type="text" class="form-input" th:field="*{name}" readonly />
              </div>

              <div class="form-group">
                <label class="form-label">성별</label>
				<div class="gender-group">
				    <div class="radioBox"><input type="radio" name="gender" value="남성" id="gender1" th:checked="*{gender == '남성'}"><label for="gender1" class="radio_check">남성</label></div>
				    <div class="radioBox"><input type="radio" name="gender" value="여성" id="gender2" th:checked="*{gender == '여성'}"><label for="gender2" class="radio_check">여성</label></div>
					<p class="helper-text" th:errors="*{gender}"></p>
				</div>
              </div>

              <div class="form-group">
                <label for="phone" class="form-label">연락처<span class="required">*</span></label>
                <input id="phone" name="phone" type="tel" class="form-input" th:field="*{phone}"/>
				<p class="helper-text" th:errors="*{phone}"></p>
              </div>

              <div class="form-group">
                <label for="email" class="form-label">이메일<span class="required">*</span></label>
                <input id="email" name="email" type="email" class="form-input" th:field="*{email}"/>
				<p class="helper-text" th:errors="*{email}"></p>
              </div>
			  
			  <div class="form-group">
			    <label for="zip" class="form-label">국가명</label>
			    <select name="address.country" class="form-input" th:field="*{address.country}">
			    	<option value="한국">한국</option>
			    	<option value="일본">일본</option>
			    	<option value="중국">중국</option>
			    	<option value="미국">미국</option>
			    	<option value="영국">영국</option>
			    	<option value="프랑스">프랑스</option>
			    </select>
			    <p class="helper-text" th:errors="*{address.country}"></p>
			  </div>

			  <div class="form-group">
			    <label for="zip" class="form-label">우편번호</label>
			    <input type="text" name="address.zipcode" class="form-input" id="zipcode" th:field="*{address.zipcode}" readonly>
			  </div>

			  <div class="addressBtn">
			    <a th:href="|javascript:searchAddress()|" class="btn btn--ghost" role="button">주소검색</a>
			  </div>

			  <div class="form-group form-group--full">
			    <label class="form-label">주소</label>
			    <div class="address-row">
			  	<input type="text" name="address.basicAddress" class="form-input" id="basicAddress" th:field="*{address.basicAddress}" readonly>
			      <input type="text" name="address.detailAddress" class="form-input" th:field="*{address.detailAddress}">
			    </div>
			    <p class="helper-text" th:errors="*{address.basicAddress}"></p>
			    <p class="helper-text" th:errors="*{address.detailAddress}"></p>
			  </div>

              <div class="form-group">
                <label for="password" class="form-label">새 비밀번호<span class="required">*</span></label>
                <input id="password" name="password" type="password" class="form-input" />
                <p class="helper-text" th:errors="*{password}"></p>
              </div>

              <div class="form-group">
                <label for="password2" class="form-label">비밀번호 확인<span class="required">*</span></label>
                <input id="password2" name="password2" type="password" class="form-input" />
				<p class="helper-text" th:errors="*{password2}"></p>
              </div>
            </div>

            <div class="form-actions">
              <a th:href="|javascript:deleteMember('*{memberId}')|" type="button" class="btn btn--ghost">삭제</a>
              <button type="submit" class="btn btn--primary">정보 수정하기</button>
            </div>
          </form>
        </section>
      </main>
    </div>
  </div>

  <!--푸터 -->
  <th:block th:replace="~{bottom}"></th:block>
  
</body>
</html>
<script>
	function searchAddress() {
		new daum.Postcode({
	        oncomplete: function(data) {
	            document.getElementById("zipcode").value = data.zonecode;
				document.getElementById("basicAddress").value = data.address;
	        }
	    }).open();
	}

	
	// 회원탈퇴
	function deleteMember(memberId) { 
		if(confirm("정말 회원을 탈퇴하겠습니까?")) {
			location.href = "/5core/member/delete/" + memberId;
		}
	}
</script>
