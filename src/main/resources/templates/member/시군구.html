<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>SGIS 3ë‹¨ í–‰ì •êµ¬ì—­ ì„ íƒ</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    select {
      width: 200px;
      height: 35px;
      font-size: 16px;
      margin-right: 10px;
    }
  </style>
</head>

<body>
  <h2>SGIS ì‹œ/ë„ â†’ ì‹œêµ°êµ¬ â†’ ìë©´ë™ SelectBox</h2>

  <select id="sido">
    <option value="">ì‹œ/ë„ ì„ íƒ</option>
  </select>

  <select id="sigungu">
    <option value="">ì‹œ/êµ°/êµ¬ ì„ íƒ</option>
  </select>

  <select id="emd">
    <option value="">ì/ë©´/ë™ ì„ íƒ</option>
  </select>

  <script>
document.addEventListener("DOMContentLoaded", () => {
	
	/*
		ë„ë©”ì¸ ë³€ê²½ (25-11-13)
		sgis.lostat.go.kr -> sgis.mods.go.kr
	*/
	
	// í† í°ê¸°ê°„: ~ 2025-12-30ì¼
    const CONSUMER_KEY = "51d6b465af6e457f8f55";        // ğŸ”¹ SGIS ë°œê¸‰
    const CONSUMER_SECRET = "ad81dbbb3fea4f0eaeb5";  // ğŸ”¹ SGIS ë°œê¸‰

    // 1) AccessToken ë°œê¸‰
    async function getToken() {
    	const url = `https://sgisapi.mods.go.kr/OpenAPI3/auth/authentication.json?consumer_key=${CONSUMER_KEY}&consumer_secret=${CONSUMER_SECRET}`;
    	const res = await fetch(url);
    	const json = await res.json();
    	return json.result.accessToken;
    }

    // 2) ì‹œ/ë„ ì¡°íšŒ (ìƒìœ„ ë‹¨ê³„)
    async function loadSido(token) {
		const url = `https://sgisapi.mods.go.kr/OpenAPI3/addr/stage.json?accessToken=${token}`;
		const res = await fetch(url);
		const json = await res.json();

		const sidoSel = document.getElementById("sido");

		json.result.forEach(item => {
			const op = document.createElement("option");
			op.value = item.cd;
			op.textContent = item.addr_name;
	        sidoSel.appendChild(op);
		});

		// ì‹œë„ ë³€ê²½ ì‹œ ì‹œêµ°êµ¬ ë¡œë“œ
		sidoSel.addEventListener("change", (e) => {
			let options = e.currentTarget.options;
			let idx = e.currentTarget.options.selectedIndex;
			console.log("ì‹œë„ê°’: "+ options[idx].textContent);
			
	        loadSigungu(token, sidoSel.value);
		});
    }
	
    // 3) ì‹œêµ°êµ¬ ì¡°íšŒ
	async function loadSigungu(token, sidoCode) {
		const url = `https://sgisapi.mods.go.kr/OpenAPI3/addr/stage.json?accessToken=${token}&cd=${sidoCode}`;
		const res = await fetch(url);
		const json = await res.json();

		const sgSel = document.getElementById("sigungu");
		sgSel.innerHTML = `<option value="">ì‹œ/êµ°/êµ¬ ì„ íƒ</option>`;

		const emdSel = document.getElementById("emd");
		emdSel.innerHTML = `<option value="">ì/ë©´/ë™ ì„ íƒ</option>`;

		json.result.forEach(item => {
			const op = document.createElement("option");
			op.value = item.cd;
			op.textContent = item.addr_name;
			sgSel.appendChild(op);
		});

      // ì‹œêµ°êµ¬ ì„ íƒ ì‹œ ìë©´ë™ ë¡œë“œ
		sgSel.addEventListener("change", (e) => {
			let options = e.currentTarget.options;
			let idx = e.currentTarget.options.selectedIndex;
			console.log("ì‹œêµ°êµ¬ê°’: "+ options[idx].textContent);
			
      		loadEmd(token, sgSel.value);
     	 });
    }
	
    // 4) ìë©´ë™ ì¡°íšŒ
	async function loadEmd(token, sigunguCode) {
		const url = `https://sgisapi.mods.go.kr/OpenAPI3/addr/stage.json?accessToken=${token}&cd=${sigunguCode}`;
		const res = await fetch(url);
		const json = await res.json();

		const emdSel = document.getElementById("emd");
		emdSel.innerHTML = `<option value="">ì/ë©´/ë™ ì„ íƒ</option>`;

		json.result.forEach(item => {
			const op = document.createElement("option");
			op.value = item.cd;
			op.textContent = item.addr_name;
			emdSel.appendChild(op);
		});
	  
		// ìë©´ë™ ì„ íƒ ì‹œ ê°’ ì¶œë ¥
		emdSel.addEventListener("change", (e) => {
			let options = e.currentTarget.options;
			let idx = e.currentTarget.options.selectedIndex;
			console.log("ìë©´ë™ê°’: "+ options[idx].textContent);
		});
	  
	  
    }
	
    // ì´ˆê¸° ì‹¤í–‰
	(async function() {
		const token = await getToken();   // 1) í† í° ë°œê¸‰
		loadSido(token);                  // 2) ì‹œë„ ë¡œë“œ
	})();
	
});

	
  </script>
</body>
</html>
